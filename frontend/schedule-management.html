<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schedule Management - ExpressGo</title>
  <style>
/* Modern Schedule Management Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: #f8f9fa;
  color: #1a1a1a;
  line-height: 1.6;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
}

/* Header */
.navbar {
  background: white;
  border-bottom: 1px solid #e8e8e8;
  padding: 16px 0;
  margin-bottom: 32px;
}

.nav-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo a {
  font-size: 24px;
  font-weight: 700;
  color: #1a1a1a;
  text-decoration: none;
}

/* Page Header */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 32px;
}

.page-header h1 {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 8px;
}

.page-header p {
  color: #666;
  font-size: 14px;
}

/* Stats Cards */
.stats-container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 24px;
}

.stat-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  border: 1px solid #e8e8e8;
}

.stat-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.stat-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.stat-dot.blue { background: #3b82f6; }
.stat-dot.green { background: #10b981; }
.stat-dot.orange { background: #f97316; }
.stat-dot.purple { background: #8b5cf6; }

.stat-label {
  font-size: 13px;
  color: #666;
}

.stat-value {
  font-size: 32px;
  font-weight: 600;
  color: #1a1a1a;
}

/* Filters Bar */
.filters-bar {
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #e8e8e8;
  flex-wrap: wrap;
  gap: 16px;
}

.filter-tabs {
  display: flex;
  gap: 8px;
  flex: 1;
}

.filter-tab {
  background: transparent;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  color: #666;
  font-weight: 500;
  transition: all 0.2s;
}

.filter-tab:hover {
  background: #f5f5f5;
  color: #1a1a1a;
}

.filter-tab.active {
  background: #1a1a1a;
  color: white;
}

.filter-actions {
  display: flex;
  gap: 12px;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 8px 12px;
  min-width: 250px;
}

.search-box input {
  border: none;
  outline: none;
  flex: 1;
  font-size: 14px;
}

.btn-primary, .btn-secondary {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: #1a1a1a;
  color: white;
}

.btn-primary:hover {
  background: #333;
}

.btn-secondary {
  background: white;
  color: #1a1a1a;
  border: 1px solid #e0e0e0;
}

.btn-secondary:hover {
  background: #f5f5f5;
}

/* Table */
.table-container {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #e8e8e8;
  margin-bottom: 20px;
}

.schedules-table {
  width: 100%;
  border-collapse: collapse;
}

.schedules-table thead {
  background: #fafafa;
  border-bottom: 1px solid #e8e8e8;
}

.schedules-table th {
  text-align: left;
  padding: 14px 16px;
  font-size: 13px;
  font-weight: 600;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.schedules-table tbody tr {
  border-bottom: 1px solid #f0f0f0;
  transition: background 0.15s;
}

.schedules-table tbody tr:hover {
  background: #fafafa;
}

.schedules-table td {
  padding: 16px;
  font-size: 14px;
  color: #1a1a1a;
}

.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
}

.status-badge.active {
  background: #dcfce7;
  color: #15803d;
}

.status-badge.inactive {
  background: #fee2e2;
  color: #b91c1c;
}

.action-buttons {
  display: flex;
  gap: 8px;
}

.btn-action {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 16px;
  padding: 6px;
  border-radius: 6px;
  transition: background 0.2s;
  display: flex;
  align-items: center;
  gap: 4px;
}

.btn-action:hover {
  background: #f0f0f0;
}

.btn-edit { color: #2563eb; }
.btn-delete { color: #dc2626; }

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal.show {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px;
  border-bottom: 1px solid #e8e8e8;
}

.modal-header h2 {
  font-size: 20px;
  font-weight: 600;
}

.modal-close {
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: background 0.2s;
}

.modal-close:hover {
  background: #f0f0f0;
}

.modal-body {
  padding: 24px;
}

/* Form Styles */
.form-row {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 16px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-group label {
  font-size: 14px;
  font-weight: 500;
  color: #333;
}

.form-group input,
.form-group select {
  padding: 10px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s;
  background: white;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.checkbox-group {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-top: 8px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #1a1a1a;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 16px;
  border-top: 1px solid #e8e8e8;
  margin-top: 24px;
}

/* Loading & Empty States */
.loading-state, .empty-state {
  text-align: center;
  padding: 60px 20px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f0f0f0;
  border-top: 4px solid #1a1a1a;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.empty-state-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-state h3 {
  margin-bottom: 8px;
}

/* Notifications */
.notification {
  position: fixed;
  top: 24px;
  right: 24px;
  background: white;
  padding: 16px 20px;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  display: none;
  align-items: center;
  gap: 12px;
  min-width: 320px;
  z-index: 2000;
  border-left: 4px solid;
}

.notification.show {
  display: flex;
  animation: slideIn 0.3s ease;
}

.notification.success {
  border-left-color: #10b981;
}

.notification.error {
  border-left-color: #ef4444;
}

.notification-content {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.notification-message h4 {
  font-size: 14px;
  margin-bottom: 2px;
}

.notification-message p {
  font-size: 13px;
  color: #666;
}

.notification-close {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Footer */
.footer {
  background: white;
  border-top: 1px solid #e8e8e8;
  margin-top: 60px;
  padding: 40px 0 20px;
}

.footer-content {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.footer h3 {
  margin-bottom: 8px;
}

.footer h4 {
  margin-bottom: 12px;
  font-size: 16px;
}

.footer p {
  color: #666;
  font-size: 14px;
  margin-bottom: 4px;
}

.footer-bottom {
  text-align: center;
  padding-top: 20px;
  border-top: 1px solid #e8e8e8;
  color: #666;
  font-size: 14px;
}

/* Responsive */
@media (max-width: 1200px) {
  .stats-container {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    gap: 16px;
  }

  .stats-container {
    grid-template-columns: 1fr;
  }

  .filters-bar {
    flex-direction: column;
  }

  .filter-tabs {
    width: 100%;
    overflow-x: auto;
  }

  .table-container {
    overflow-x: auto;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .checkbox-group {
    grid-template-columns: repeat(2, 1fr);
  }
}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="navbar">
    <div class="container nav-content">
      <div class="logo"><a href="index.html">ExpressGo</a></div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h1>Schedule Management</h1>
          <p>Manage bus schedules, routes, and timing</p>
        </div>
        <button class="btn-primary" id="addScheduleBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>Add New Schedule</span>
        </button>
      </div>

      <!-- Stats Cards -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-dot blue"></span>
            <span class="stat-label">Total Schedules</span>
          </div>
          <div class="stat-value" id="totalSchedules">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-dot green"></span>
            <span class="stat-label">Active Schedules</span>
          </div>
          <div class="stat-value" id="activeSchedules">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-dot orange"></span>
            <span class="stat-label">Inactive Schedules</span>
          </div>
          <div class="stat-value" id="inactiveSchedules">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-dot purple"></span>
            <span class="stat-label">Total Routes</span>
          </div>
          <div class="stat-value" id="totalRoutes">0</div>
        </div>
      </div>

      <!-- Filters Bar -->
      <div class="filters-bar">
        <div class="filter-tabs">
          <button class="filter-tab active" data-filter="all">All</button>
          <button class="filter-tab" data-filter="active">Active</button>
          <button class="filter-tab" data-filter="inactive">Inactive</button>
        </div>
        <div class="filter-actions">
          <div class="search-box">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" placeholder="Search schedules..." id="searchInput">
          </div>
          <select id="routeFilter" style="padding: 10px 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            <option value="">All Routes</option>
          </select>
          <button class="btn-secondary" id="refreshBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"></polyline>
              <polyline points="1 20 1 14 7 14"></polyline>
              <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
            <span>Refresh</span>
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="schedules-table" id="schedulesTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Route</th>
              <th>Bus/Agent</th>
              <th>Departure</th>
              <th>Arrival</th>
              <th>Price (RWF)</th>
              <th>Available Days</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="schedulesTableBody">
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>

        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
          <div class="spinner"></div>
          <p>Loading schedules...</p>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
          <div class="empty-state-icon">ðŸ“…</div>
          <h3>No schedules found</h3>
          <p>Create your first bus schedule to get started.</p>
          <button class="btn-primary" onclick="scheduleManager.openScheduleModal()">Add Schedule</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Schedule Modal -->
  <div class="modal" id="scheduleModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add New Schedule</h2>
        <button class="modal-close" id="closeModalBtn">âœ•</button>
      </div>

      <div class="modal-body">
        <form class="schedule-form" id="scheduleForm">
          <div class="form-row">
            <div class="form-group">
              <label for="busSelect">Bus/Agent *</label>
              <select id="busSelect" name="bus_id" required>
                <option value="">Select Bus/Agent</option>
                <option value="1">RITCO - RAD 001 A</option>
                <option value="2">Volcano - RAD 002 B</option>
                <option value="3">Alpha Express - RAD 003 C</option>
                <option value="4">City Express - RAD 004 D</option>
                <option value="5">Matunda Express - RAD 005 E</option>
                <option value="6">Select Express - RAD 006 F</option>
                <option value="7">Yahoo Express - RAD 007 G</option>
              </select>
            </div>

            <div class="form-group">
              <label for="routeSelect">Route *</label>
              <select id="routeSelect" name="route_id" required>
                <option value="">Select Route</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="departureTime">Departure Time *</label>
              <input type="time" id="departureTime" name="departure_time" required>
            </div>

            <div class="form-group">
              <label for="arrivalTime">Arrival Time *</label>
              <input type="time" id="arrivalTime" name="arrival_time" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="priceInput">Price (RWF) *</label>
              <input type="number" id="priceInput" name="price" min="0" step="500" required>
            </div>

            <div class="form-group">
              <label for="statusSelect">Status *</label>
              <select id="statusSelect" name="is_active" required>
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Available Days *</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Monday" checked>
                <span>Monday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Tuesday" checked>
                <span>Tuesday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Wednesday" checked>
                <span>Wednesday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Thursday" checked>
                <span>Thursday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Friday" checked>
                <span>Friday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Saturday" checked>
                <span>Saturday</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="days" value="Sunday" checked>
                <span>Sunday</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn-primary" id="saveBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Save Schedule</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Delete Schedule</h2>
        <button class="modal-close" onclick="scheduleManager.closeDeleteModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px;">Are you sure you want to delete this schedule?</p>
        <div id="deleteScheduleDetails" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <!-- Schedule details will be populated by JavaScript -->
        </div>
        <p style="color: #dc2626; font-size: 14px; display: flex; align-items: center; gap: 8px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          This action cannot be undone.
        </p>
        <div class="form-actions" style="margin-top: 24px;">
          <button type="button" class="btn-secondary" id="cancelDeleteBtn">Cancel</button>
          <button type="button" class="btn-primary" id="confirmDeleteBtn" style="background: #dc2626;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            <span>Delete Schedule</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Notification -->
  <div class="notification success" id="successNotification">
    <div class="notification-content">
      <div class="notification-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="notification-message">
        <h4>Success!</h4>
        <p id="successMessage">Operation completed successfully</p>
      </div>
    </div>
    <button class="notification-close" onclick="closeNotification('successNotification')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Error Notification -->
  <div class="notification error" id="errorNotification">
    <div class="notification-content">
      <div class="notification-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <div class="notification-message">
        <h4>Error!</h4>
        <p id="errorMessage">Something went wrong</p>
      </div>
    </div>
    <button class="notification-close" onclick="closeNotification('errorNotification')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer-content">
      <div>
        <h3>ExpressGo</h3>
        <p>Reliable transport across Rwanda.</p>
      </div>
      <div>
        <h4>Contact</h4>
        <p>Email: info@expressgo.com</p>
        <p>Phone: +250 7813 489</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© 2025 ExpressGo. All rights reserved.</p>
    </div>
  </footer>

  <script>
// Schedule Management JavaScript
class ScheduleManager {
  constructor() {
    this.schedules = [];
    this.filteredSchedules = [];
    this.routes = [];
    this.currentScheduleId = null;
    this.isEditing = false;
    this.currentFilter = 'all';
  }

  init() {
    this.bindEvents();
    this.loadInitialData();
  }

  bindEvents() {
    // Modal events
    const addScheduleBtn = document.getElementById('addScheduleBtn');
    if (addScheduleBtn) addScheduleBtn.addEventListener('click', () => this.openScheduleModal());

    const closeModalBtn = document.getElementById('closeModalBtn');
    if (closeModalBtn) closeModalBtn.addEventListener('click', () => this.closeScheduleModal());

    const cancelBtn = document.getElementById('cancelBtn');
    if (cancelBtn) cancelBtn.addEventListener('click', () => this.closeScheduleModal());

    // Form events
    const scheduleForm = document.getElementById('scheduleForm');
    if (scheduleForm) scheduleForm.addEventListener('submit', (e) => this.handleFormSubmit(e));

    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        this.currentFilter = e.target.dataset.filter;
        this.applyFilters();
      });
    });

    // Search and filters
    const routeFilter = document.getElementById('routeFilter');
    if (routeFilter) routeFilter.addEventListener('change', () => this.applyFilters());

    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.addEventListener('input', () => this.applyFilters());

    const refreshBtn = document.getElementById('refreshBtn');
    if (refreshBtn) refreshBtn.addEventListener('click', () => this.loadSchedules());

    // Delete modal events
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    if (cancelDeleteBtn) cancelDeleteBtn.addEventListener('click', () => this.closeDeleteModal());

    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    if (confirmDeleteBtn) confirmDeleteBtn.addEventListener('click', () => this.confirmDelete());

    // Close modals on outside click
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        this.closeScheduleModal();
        this.closeDeleteModal();
      }
    });
  }

  async loadInitialData() {
    this.showLoading();
    try {
      this.loadMockRoutes();
      this.loadMockSchedules();
      this.showSuccess('Schedule management loaded successfully');
    } catch (error) {
      console.error('Error loading data:', error);
      this.showError('Failed to load data');
    } finally {
      this.hideLoading();
    }
  }

  loadMockRoutes() {
    this.routes = [
      { id: 1, departure_city: 'Kigali - Nyabugogo', arrival_city: 'Musanze', distance: 116 },
      { id: 2, departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rubavu', distance: 160 },
      { id: 3, departure_city: 'Kigali - Nyabugogo', arrival_city: 'Huye', distance: 136 },
      { id: 4, departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rusizi', distance: 228 },
      { id: 5, departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rwamagana', distance: 55 },
      { id: 6, departure_city: 'Butare', arrival_city: 'Nyanza', distance: 45 },
      { id: 7, departure_city: 'Huye', arrival_city: 'Nyamagabe', distance: 60 },
      { id: 8, departure_city: 'Nyagatare', arrival_city: 'Kayonza', distance: 85 },
      { id: 9, departure_city: 'Rubavu', arrival_city: 'Karongi', distance: 95 },
      { id: 10, departure_city: 'Rusizi', arrival_city: 'Nyamasheke', distance: 45 }
    ];
    this.populateRouteSelects();
  }

  loadMockSchedules() {
    this.schedules = [
      {
        id: 1,
        bus_id: 1,
        route_id: 1,
        departure_time: '06:00:00',
        arrival_time: '09:30:00',
        price: 2200,
        available_days: 'Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday',
        is_active: true,
        bus: { plate_number: 'RAD 001 A', company_name: 'RITCO' },
        route: { departure_city: 'Kigali - Nyabugogo', arrival_city: 'Musanze' }
      },
      {
        id: 2,
        bus_id: 2,
        route_id: 2,
        departure_time: '08:00:00',
        arrival_time: '13:00:00',
        price: 4200,
        available_days: 'Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday',
        is_active: true,
        bus: { plate_number: 'RAD 002 B', company_name: 'Volcano' },
        route: { departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rubavu' }
      },
      {
        id: 3,
        bus_id: 3,
        route_id: 3,
        departure_time: '10:00:00',
        arrival_time: '14:30:00',
        price: 3000,
        available_days: 'Monday,Tuesday,Wednesday,Thursday,Friday',
        is_active: false,
        bus: { plate_number: 'RAD 003 C', company_name: 'Alpha Express' },
        route: { departure_city: 'Kigali - Nyabugogo', arrival_city: 'Huye' }
      },
      {
        id: 4,
        bus_id: 4,
        route_id: 4,
        departure_time: '07:30:00',
        arrival_time: '14:00:00',
        price: 5500,
        available_days: 'Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday',
        is_active: true,
        bus: { plate_number: 'RAD 004 D', company_name: 'City Express' },
        route: { departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rusizi' }
      },
      {
        id: 5,
        bus_id: 5,
        route_id: 5,
        departure_time: '09:00:00',
        arrival_time: '11:00:00',
        price: 1500,
        available_days: 'Monday,Tuesday,Wednesday,Thursday,Friday',
        is_active: true,
        bus: { plate_number: 'RAD 005 E', company_name: 'Matunda Express' },
        route: { departure_city: 'Kigali - Nyabugogo', arrival_city: 'Rwamagana' }
      }
    ];
    
    this.updateStats();
    this.applyFilters();
  }

  populateRouteSelects() {
    const routeSelects = ['routeSelect', 'routeFilter'];
    routeSelects.forEach(selectId => {
      const select = document.getElementById(selectId);
      if (!select) return;

      const firstOption = select.children[0];
      select.innerHTML = '';
      select.appendChild(firstOption);

      this.routes.forEach(route => {
        const option = document.createElement('option');
        option.value = route.id;
        option.textContent = `${route.departure_city} â†’ ${route.arrival_city}`;
        select.appendChild(option);
      });
    });
  }

  updateStats() {
    const total = this.schedules.length;
    const active = this.schedules.filter(s => s.is_active).length;
    const inactive = this.schedules.filter(s => !s.is_active).length;

    document.getElementById('totalSchedules').textContent = total;
    document.getElementById('activeSchedules').textContent = active;
    document.getElementById('inactiveSchedules').textContent = inactive;
    document.getElementById('totalRoutes').textContent = this.routes.length;
  }

  applyFilters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const routeFilter = document.getElementById('routeFilter').value;

    this.filteredSchedules = this.schedules.filter(schedule => {
      const matchesStatus = this.currentFilter === 'all' || 
        (this.currentFilter === 'active' && schedule.is_active) ||
        (this.currentFilter === 'inactive' && !schedule.is_active);
      
      const matchesRoute = !routeFilter || schedule.route_id === parseInt(routeFilter);
      
      const matchesSearch = !searchTerm || 
        schedule.bus.company_name.toLowerCase().includes(searchTerm) ||
        schedule.bus.plate_number.toLowerCase().includes(searchTerm) ||
        schedule.route.departure_city.toLowerCase().includes(searchTerm) ||
        schedule.route.arrival_city.toLowerCase().includes(searchTerm);
      
      return matchesStatus && matchesRoute && matchesSearch;
    });

    this.renderSchedules();
  }

  showLoading() {
    const loadingState = document.getElementById('loadingState');
    const schedulesTable = document.getElementById('schedulesTable');
    const emptyState = document.getElementById('emptyState');

    if (loadingState) loadingState.style.display = 'block';
    if (schedulesTable) schedulesTable.style.display = 'none';
    if (emptyState) emptyState.style.display = 'none';
  }

  hideLoading() {
    const loadingState = document.getElementById('loadingState');
    if (loadingState) loadingState.style.display = 'none';
  }

  renderSchedules() {
    const tbody = document.getElementById('schedulesTableBody');
    const schedulesTable = document.getElementById('schedulesTable');
    const emptyState = document.getElementById('emptyState');

    if (!tbody) return;

    this.hideLoading();

    if (this.filteredSchedules.length === 0) {
      if (schedulesTable) schedulesTable.style.display = 'none';
      if (emptyState) emptyState.style.display = 'block';
      return;
    }

    if (emptyState) emptyState.style.display = 'none';
    if (schedulesTable) schedulesTable.style.display = 'table';

    tbody.innerHTML = this.filteredSchedules.map(schedule => {
      const route = `${schedule.route.departure_city} â†’ ${schedule.route.arrival_city}`;
      const busInfo = `${schedule.bus.company_name} - ${schedule.bus.plate_number}`;
      const departureTime = this.formatTime(schedule.departure_time);
      const arrivalTime = this.formatTime(schedule.arrival_time);
      const price = parseInt(schedule.price).toLocaleString();
      const statusClass = schedule.is_active ? 'active' : 'inactive';
      const statusText = schedule.is_active ? 'Active' : 'Inactive';

      return `
        <tr>
          <td>#${schedule.id}</td>
          <td>${route}</td>
          <td>${busInfo}</td>
          <td>${departureTime}</td>
          <td>${arrivalTime}</td>
          <td>${price}</td>
          <td>${this.formatDays(schedule.available_days)}</td>
          <td><span class="status-badge ${statusClass}">${statusText}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn-action btn-edit" onclick="scheduleManager.editSchedule(${schedule.id})" title="Edit">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button class="btn-action btn-delete" onclick="scheduleManager.deleteSchedule(${schedule.id})" title="Delete">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }

  formatTime(timeString) {
    const [hours, minutes] = timeString.split(':');
    const hour24 = parseInt(hours);
    const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;
    const period = hour24 >= 12 ? 'PM' : 'AM';
    return `${hour12}:${minutes} ${period}`;
  }

  formatDays(daysString) {
    if (!daysString) return 'Not set';
    const days = daysString.split(',');
    const allDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

    if (days.length === 7 && allDays.every(day => days.includes(day))) return 'Daily';
    if (days.length === 5 && !days.includes('Saturday') && !days.includes('Sunday')) return 'Weekdays';
    if (days.length === 2 && days.includes('Saturday') && days.includes('Sunday')) return 'Weekends';
    return days.map(day => day.substring(0, 3)).join(', ');
  }

  openScheduleModal(scheduleId = null) {
    const modal = document.getElementById('scheduleModal');
    const form = document.getElementById('scheduleForm');
    const modalTitle = document.getElementById('modalTitle');

    if (scheduleId) {
      this.isEditing = true;
      this.currentScheduleId = scheduleId;
      const schedule = this.schedules.find(s => s.id === scheduleId);
      
      if (schedule) {
        modalTitle.textContent = 'Edit Schedule';
        document.getElementById('busSelect').value = schedule.bus_id;
        document.getElementById('routeSelect').value = schedule.route_id;
        document.getElementById('departureTime').value = schedule.departure_time.substring(0, 5);
        document.getElementById('arrivalTime').value = schedule.arrival_time.substring(0, 5);
        document.getElementById('priceInput').value = schedule.price;
        document.getElementById('statusSelect').value = schedule.is_active.toString();

        const days = schedule.available_days.split(',');
        document.querySelectorAll('input[name="days"]').forEach(checkbox => {
          checkbox.checked = days.includes(checkbox.value);
        });
      }
    } else {
      this.isEditing = false;
      this.currentScheduleId = null;
      modalTitle.textContent = 'Add New Schedule';
      form.reset();
      document.querySelectorAll('input[name="days"]').forEach(checkbox => {
        checkbox.checked = true;
      });
    }

    modal.classList.add('show');
  }

  closeScheduleModal() {
    const modal = document.getElementById('scheduleModal');
    modal.classList.remove('show');
    this.isEditing = false;
    this.currentScheduleId = null;
  }

  handleFormSubmit(e) {
    e.preventDefault();

    const formData = {
      bus_id: parseInt(document.getElementById('busSelect').value),
      route_id: parseInt(document.getElementById('routeSelect').value),
      departure_time: document.getElementById('departureTime').value + ':00',
      arrival_time: document.getElementById('arrivalTime').value + ':00',
      price: parseInt(document.getElementById('priceInput').value),
      is_active: document.getElementById('statusSelect').value === 'true',
      available_days: Array.from(document.querySelectorAll('input[name="days"]:checked'))
        .map(cb => cb.value)
        .join(',')
    };

    if (this.isEditing) {
      const schedule = this.schedules.find(s => s.id === this.currentScheduleId);
      if (schedule) {
        Object.assign(schedule, formData);
        this.showSuccess('Schedule updated successfully');
      }
    } else {
      const newId = Math.max(...this.schedules.map(s => s.id), 0) + 1;
      const route = this.routes.find(r => r.id === formData.route_id);
      
      const buses = [
        { id: 1, plate_number: 'RAD 001 A', company_name: 'RITCO' },
        { id: 2, plate_number: 'RAD 002 B', company_name: 'Volcano' },
        { id: 3, plate_number: 'RAD 003 C', company_name: 'Alpha Express' },
        { id: 4, plate_number: 'RAD 004 D', company_name: 'City Express' },
        { id: 5, plate_number: 'RAD 005 E', company_name: 'Matunda Express' },
        { id: 6, plate_number: 'RAD 006 F', company_name: 'Select Express' },
        { id: 7, plate_number: 'RAD 007 G', company_name: 'Yahoo Express' }
      ];
      const bus = buses.find(b => b.id === formData.bus_id);

      const newSchedule = {
        id: newId,
        ...formData,
        bus: bus,
        route: route
      };

      this.schedules.push(newSchedule);
      this.showSuccess('Schedule created successfully');
    }

    this.updateStats();
    this.applyFilters();
    this.closeScheduleModal();
  }

  editSchedule(id) {
    this.openScheduleModal(id);
  }

  deleteSchedule(id) {
    const schedule = this.schedules.find(s => s.id === id);
    if (!schedule) return;

    this.currentScheduleId = id;
    const modal = document.getElementById('deleteModal');
    const detailsDiv = document.getElementById('deleteScheduleDetails');

    detailsDiv.innerHTML = `
      <p><strong>Route:</strong> ${schedule.route.departure_city} â†’ ${schedule.route.arrival_city}</p>
      <p><strong>Bus:</strong> ${schedule.bus.company_name} - ${schedule.bus.plate_number}</p>
      <p><strong>Departure:</strong> ${this.formatTime(schedule.departure_time)}</p>
      <p><strong>Price:</strong> ${schedule.price.toLocaleString()} RWF</p>
    `;

    modal.classList.add('show');
  }

  closeDeleteModal() {
    const modal = document.getElementById('deleteModal');
    modal.classList.remove('show');
    this.currentScheduleId = null;
  }

  confirmDelete() {
    if (!this.currentScheduleId) return;

    this.schedules = this.schedules.filter(s => s.id !== this.currentScheduleId);
    this.updateStats();
    this.applyFilters();
    this.closeDeleteModal();
    this.showSuccess('Schedule deleted successfully');
  }

  loadSchedules() {
    this.showLoading();
    setTimeout(() => {
      this.loadMockSchedules();
      this.showSuccess('Schedules refreshed');
    }, 500);
  }

  showSuccess(message) {
    this.showNotification('success', message);
  }

  showError(message) {
    this.showNotification('error', message);
  }

  showNotification(type, message) {
    const notification = document.getElementById(`${type}Notification`);
    const messageEl = document.getElementById(`${type}Message`);
    
    if (notification && messageEl) {
      messageEl.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }
  }

  closeNotification(notificationId) {
    const notification = document.getElementById(notificationId);
    if (notification) {
      notification.classList.remove('show');
    }
  }
}

// Initialize
let scheduleManager;

document.addEventListener('DOMContentLoaded', () => {
  scheduleManager = new ScheduleManager();
  scheduleManager.init();
});

// Global functions
function closeNotification(notificationId) {
  if (scheduleManager) {
    scheduleManager.closeNotification(notificationId);
  }
}
  </script>
</body>
</html>